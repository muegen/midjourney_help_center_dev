(function(){"use strict";var a={RENDER:"articleNavigation:render"};window.ArticleNavigation=Util.createExtension({defaults:{collection:{},sideloading:SIDELOADING,articleId:null,nextTitle:"Next article",previousTitle:"Next article",labels:[],properties:["id","title","description","name","html_url","position","promoted","pinned","draft","section_id","sorting","category_id","parent_section_id","topic_id","created_at"],filter:{categories:null,sections:null,articles:function(a){return!0!==a.draft}},sort:{categories:"sortByPosition",sections:"sortByPosition",articles:null},sortOrder:"asc",template:null,templateData:{}},optionTypes:{collection:"object",sideloading:"(string|boolean)",articleId:"(string|number|null)",nextTitle:"string",previousTitle:"string",labels:"(string|array)",properties:"(string|array)",sort:"(string|object)",sortOrder:"string",filter:"(string|object|null)",template:"(string|null)",templateData:"(string|object)"},initialize:function(a){for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];if("string"==typeof c&&/object|array/g.test(this.optionTypes[b]))try{this.options[b]=a[b]=JSON.parse(c)}catch(c){this.options[b]=a[b]=this.defaults[b],console.error("Option value ("+b+") is not a valid JSON string.")}}if(a.collection&&a.collection.hasOwnProperty("articles"))this.render(a.collection);else{if(!a.articleId){if(!Util.isArticlePage())return void console.error("An article ID must be specified");a.articleId=Util.getPageId()}this._getObjects(a.properties).then(this.render.bind(this))}},_getObjects:function(a){var b=[this._getArticles(a)];return!1===this.options.sideloading&&b.push(Util.get(["categories","sections"],a)),Promise.all(b).then(function(a){return Object.assign.apply(Object,a)})},_getArticles:function(a){var b=this.options;if(!b.labels.length)return!1===b.sideloading?Util.get(["articles"],a):Util.get(["categories","sections","articles"],a);var c="/api/v2/help_center/"+Util.locale+"/articles.json",d=[];return!0===b.sideloading&&d.push("include=categories,sections"),b.labels.length&&d.push("label_names="+b.labels.join(",")),d.length&&(c+="?"+d.join("&")),Util.request(c,a)},_sortArticles:function(a){var b=this._filterObjects(a.categories,"categories").reverse(),c=this._filterObjects(a.sections,"sections").reverse(),d=this._filterObjects(a.articles,"articles"),e=this._sortObjects.bind(this),f=e(b,"categories"),g=e(c,"sections"),h=[],i=function(a){var b=g.filter(function(b){return b.parent_section_id===a.id});b.forEach(j)},j=function(a){var b=d.filter(function(b){return b.section_id===a.id});a.hasOwnProperty("sorting")&&("manual"===a.sorting&&b.sort(Util.sortByPosition),"title"===a.sorting&&b.sort(Util.sortByName),"creation_asc"===a.sorting&&b.sort(Util.sortByDate),"creation_desc"===a.sorting&&b.sort(Util.sortByDate).reverse()),b.sort(Util.sortByPromoted),h=h.concat(b),i(a)};return f.forEach(function(a){var b=g.filter(function(b){return b.category_id===a.id&&null===b.parent_section_id});b.forEach(function(a){j(a),i(a)})}),"desc"===this.options.sortOrder?h.reverse():h},_filterObjects:function(a,b){var c=this.options,d=c.filter.hasOwnProperty(b)?c.filter[b]:null;return"function"==typeof d?a.filter(d):"string"==typeof d&&"function"==typeof Util[d]?a.filter(Util[d]):a},_sortObjects:function(a,b){var c=this.options,d=c.sort.hasOwnProperty(b)?c.sort[b]:null;return"function"==typeof d?a.sort(d):"string"==typeof d&&"function"==typeof Util[d]?a.sort(Util[d]):a},render:function(b){for(var c,d=this.options,e=this._sortArticles(b),f=0;f<e.length;f++)if(e[f].id===d.articleId){c=f;break}var g={collection:b,nextTitle:this.options.nextTitle,currentArticle:e[c],previousTitle:this.options.previousTitle,previousArticle:0<=c-1?e[c-1]:null,nextArticle:c+1<e.length?e[c+1]:null};d.templateData&&(g=Util.extend(g,d.templateData)),Util.renderTemplate(this.el,d.template,g,{replaceContent:!0}),Util.triggerEvent(this.el,a.RENDER,{relatedTarget:this.el,articles:e})}}),window.addEventListener("load",function(){each("[data-element=\"article-navigation\"]",function(a){new ArticleNavigation(a)})})})();